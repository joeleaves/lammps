#LAMMPS Input file generated by Avogadro and heavily edited by JDE.

# Intialization
units          real
dimension      3
boundary       p p p
atom_style     full

# Read the configuration from Avogadro.
read_data      SPCE_HOD.lmpdat

#Type 1 is H, type 2 is O, type 3 is D.
#Now create some groups.

group           deuterium type 1
group           oxygens type 2
group           hydrogen type 3
group           HOD molecule 1
group           oxygen id 1 #It is VERY IMPORTANT that the HOD molecule is molecule 1 and that the first id corresponds to O on that molecule.

#Parameters for the SPC/E Potential and mass parameters for HOD in D2O.
variable	QO equal -0.8476
variable	QH equal ${QO}*(-0.5)
variable    sigma equal 3.166
variable    epsilon equal 0.15535
variable    LJ_cutoff equal ${sigma}*2.5

#Simulation parameters for running the simulation. 
variable    seed equal 980411
variable    equilibrium_number_of_steps equal 5000
variable    run_steps equal 5000

#The SPC/E water potential
pair_style      lj/cut/coul/long 9.8
kspace_style    pppm 1.0e-4
pair_coeff      1 * 0.0 0.0 #Specify the deuterium LJ coefficients.
pair_coeff      3 * 0.0 0.0 #Specify the hydrogen LJ coefficients.
pair_coeff      2 2 ${epsilon} ${sigma} ${LJ_cutoff}
set             group deuterium charge ${QH}
set             group hydrogen charge ${QH}
set   		    group oxygens charge ${QO}
bond_style      harmonic
angle_style     harmonic
dihedral_style  none
improper_style  none
bond_coeff      1 100.00   1.000
angle_coeff     1 100.00 109.47
special_bonds   lj/coul 0.0 0.0 0.0#I do not understand why we must keep this line.

#min_style cg
#minimize        1.0e-4 1.0e-6 100 1000

# Settings

fix            ensemble all nvt temp 298.15 298.15 100 tchain 1
fix            RigidOHBonds all shake 0.0001 20 0 b 1 a 1 #Rattle gives the wrong pressure. I think this is an issue with the calculation of the virial.
velocity       all create 298.15 ${seed} rot yes mom yes dist gaussian

timestep       1.0

# Output
thermo_style   custom step temp etotal press 
thermo         50

# Equilibrate for 10 ps. 
run            ${equilibrium_number_of_steps}


dump           Odump oxygen custom 5 oxygen.lammpstrj xu yu zu fx fy fz 
dump           Hdump hydrogen custom 5 hydrogen.lammpstrj xu yu zu fx fy fz

#Run the trajectory. 
run            ${run_steps} 